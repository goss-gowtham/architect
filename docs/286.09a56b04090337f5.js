"use strict";(self.webpackChunkarchitect=self.webpackChunkarchitect||[]).push([[286],{3286:(ft,b,s)=>{s.r(b),s.d(b,{ClientsModule:()=>ut});var h=s(177),z=s(6530),T=s(7661),l=s(4341),t=s(4438),v=s(3390),m=s(7529);function F(o,c){1&o&&(t.j41(0,"div",10),t.EFF(1," Please enter a valid email address "),t.k0s())}function x(o,c){1&o&&(t.j41(0,"div",10),t.EFF(1," Please enter a valid phone number "),t.k0s())}let G=(()=>{class o{fb;modal;user;userDetailsForm;constructor(n,e){this.fb=n,this.modal=e,this.user=this.modal.getConfig().nzData.user,this.userDetailsForm=this.fb.group({email:["",[l.k0.required,l.k0.email]],phone:["",[l.k0.required,l.k0.pattern(/^\d{10}$/)]]})}ngOnInit(){this.user&&this.userDetailsForm.patchValue({email:this.user.email,phone:this.user.phone})}getUserDetails(){return{...this.user,email:this.userDetailsForm.value.email,phone:this.userDetailsForm.value.phone}}static \u0275fac=function(e){return new(e||o)(t.rXU(l.ok),t.rXU(v.J9))};static \u0275cmp=t.VBU({type:o,selectors:[["app-user-details-form"]],standalone:!1,decls:17,vars:7,consts:[[3,"formGroup"],["nz-form-item","","nz-row",""],["nz-form-label","","nz-col","",3,"nzSpan"],["for","email"],["nz-form-control","","nz-col","",3,"nzSpan"],["nz-input","","id","email","formControlName","email"],["nz-error-tip","",4,"ngIf"],["for","phone"],["nz-input","","id","phone","formControlName","phone"],[1,"info-message"],["nz-error-tip",""]],template:function(e,i){if(1&e&&(t.j41(0,"form",0)(1,"div",1)(2,"div",2)(3,"label",3),t.EFF(4,"Email"),t.k0s()(),t.j41(5,"div",4),t.nrm(6,"input",5),t.DNE(7,F,2,0,"div",6),t.k0s()(),t.j41(8,"div",1)(9,"div",2)(10,"label",7),t.EFF(11,"Phone"),t.k0s()(),t.j41(12,"div",4),t.nrm(13,"input",8),t.DNE(14,x,2,0,"div",6),t.k0s()()(),t.j41(15,"p",9),t.EFF(16,"We use your details only to acknowledge payments by these medium."),t.k0s()),2&e){let r,a;t.Y8G("formGroup",i.userDetailsForm),t.R7$(2),t.Y8G("nzSpan",6),t.R7$(3),t.Y8G("nzSpan",14),t.R7$(2),t.Y8G("ngIf",(null==(r=i.userDetailsForm.get("email"))?null:r.invalid)&&(null==(r=i.userDetailsForm.get("email"))?null:r.touched)),t.R7$(2),t.Y8G("nzSpan",6),t.R7$(3),t.Y8G("nzSpan",14),t.R7$(2),t.Y8G("ngIf",(null==(a=i.userDetailsForm.get("phone"))?null:a.invalid)&&(null==(a=i.userDetailsForm.get("phone"))?null:a.touched))}},dependencies:[h.bT,m.Uq,m.e,l.qT,l.me,l.BC,l.cb,l.j4,l.JD],styles:["form[_ngcontent-%COMP%]{padding:16px}[nz-form-item][_ngcontent-%COMP%]{margin-bottom:16px}[nz-form-label][_ngcontent-%COMP%]{text-align:left}[nz-form-control][_ngcontent-%COMP%], input[nz-input][_ngcontent-%COMP%]{width:100%}.info-message[_ngcontent-%COMP%]{padding:16px;font-size:14px;color:#888;text-align:center}"]})}return o})();var D=s(7673),B=s(5558),u=s(6354),U=s(9437),A=s(2020),R=s(4389),X=s(6368),Y=s(6648),M=s(1626),O=s(820);let N=(()=>{class o{http;dbService;testMode=!0;key="KfPgjF";salt="MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDITVAeH89oo1hL+8eMcnrZjjKPiW7StfX3WA6gwh/VORR2Cat6EB6YEwFj+rQCJAcXRcjoE2rtruBEfWJlKpZ0ohiYqUOQjrTONgjwbqYwJU3LaCD2dY7PDMCPoylKIv5GO1WLdLQJBc7CQkcNag7gnEDGVLseO65dx2WdnsJQOJij+RdrmiTjrL+OXTCKihWgU06k/Q7Y4JfdPXSjiwYcOnHTpSYrYbBdVWyz+RBJM84ZzIDRHkQFEhSL9Nu98uyINrpyB3wQegDZltCbxD0sb8JP3KSCkBnBiXO56wvWUcg36XkxqWHBVBP0ZgymIHMGaLzWX6FYcUh4HGmRQiRbAgMBAAECggEAFtC/pH7JGEkq4JTQWQ4dMjTBS5pC9ltlpgPwvpz+FUKIMx3M232Ejpvzl5jR8kB6UktPpCe6EVLPFt4VXCKquqRQGuuE1615qNd80y43XdqR7u5wesJPPwRb1sCmDlzIC+XsS5NCgpiXwYbdIwkGos0Jj83M9pejt+jjiT2xMoPcFCL1hUsuNBORvyOZBGaajPC9goO1NJCmrtnik6Gzx+UOR6ZiOjj50so7kYbg0QUHa28nLf8B/JhL4DL9nKHNBV2qEYl3v3YLoA2FP9qne8fOL1Ml75zK+sR8eiinBmOl0OQcNkBOsFsUEiMDNO+74PlpbwPotedojH7ErYkH0QKBgQD12uCmw8C4MzOwT5SjlkXyIWGai9AuWXTmWW9KwHjftTmwRp+X7gS8bWtLdIYd4L3rUIoCNvKmRNxaQMuN80fFgJ/Ofy6nfJq7ShPm//RFknLY/WvNi9gb4pDxqn5GnMfMbMD+JMBz6y75ADBPSJVmeqUv9oAbP+NObja27dXo4wKBgQDQkTrzcSCZvfU97bO6qtKhGAUQVrl0f6Gg3YgWbMiTmzP7/zIkJkbVAzhFrPd6n/PUkqUisN28j1UFe2Hk+EO8TY8NuH7efag6V+Ht2SHZIlQWGs42K5u/eN0H2dHlL0vn0P2TfTy1tbYeCHCtoGIKXHadxDiPDYrXKmWA1YBIKQKBgQCRYabqtmLmCdEM92IsAhbGgZrX6slmPxvzgvtetsZDc0Tzyi9hhixiyElkSzlrvZRQ7EVP3fJLA/lRnXNBM5VDYzYcw/RwsixFiB6QwNZPtbQYQHNZDtLyWl3fqjQVyWwUpFLTdiQf5/jU4ZmvqHpAKVI5NIi4lGTz4hSUw7t0hQKBgA7x2R+Ig6WAjwoY9j/x7ZXNes9o53EJlDNKrG2u7dBl1pu/9X/RnlG1IVscwb7vpzEcMOkDc2AHhTgXVzRo9bGQfSemiLC4oE1N7sp0PJCqfQv4b75B8a8Oogfl+7xIX1AFEaZ32tnKY3pTcH+AdoX3iihT3xmhBsnUJ+HLap3BAoGBAO1E7ky8VwbI4fhjaiAceocDdUhYsalhZZqZfQQ8+jjwfxRH8z1amiQxpSXNOV25rHur/3lKcYj1IBVeCiJlemQr6+ZW41e2QelOJ4OdCQ77SdQq1TgklVPSPDZTitL+MkredR2ki/MYSlDY7PyUmgU5AfkMpUgnfBC/+jeggJGo";constructor(n,e){this.http=n,this.dbService=e}initiatePayUPayment(n,e){const i=this.testMode?"https://test.payu.in/_payment":"https://secure.payu.in/_payment",r=(0,X.A)(),a=window.location.origin,p=`https://us-central1-architect-design-7.cloudfunctions.net/updatePaidProjects?userId=${e.id}&projectId=${n.projectId}&tranId=${r}&referer=${encodeURIComponent(a)}`,P=`${window.location.origin}/architect/clients?status=failure`;return this.generateHash(`${this.key}|${r}|${n.pay}|${n.project}|${n.username}|${e.email}|||||||||||${this.salt}`).pipe((0,u.T)(gt=>{const d=document.createElement("form");d.method="POST",d.action=i,d.target="_self";const E={key:this.key,txnid:r,amount:n.pay,productinfo:n.project,firstname:n.username,email:e.email,phone:e.phone,surl:p,furl:P,hash:gt,service_provider:"",referer:a};Object.keys(E).forEach(I=>{const C=document.createElement("input");C.type="hidden",C.name=I,C.value=E[I],d.appendChild(C)}),document.body.appendChild(d),d.submit()}))}generateHash(n){const e=(new TextEncoder).encode(n);return(0,Y.H)(crypto.subtle.digest("SHA-512",e)).pipe((0,u.T)(i=>this.bufferToHex(i)))}bufferToHex(n){return Array.prototype.map.call(new Uint8Array(n),e=>("00"+e.toString(16)).slice(-2)).join("")}static \u0275fac=function(e){return new(e||o)(t.KVO(M.Qq),t.KVO(O.a))};static \u0275prov=t.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var w=s(3719),Q=s(9803),y=s(2914),g=s(5664),S=s(513),$=s(6389),L=s(5930),V=s(1413),H=s(6977),f=s(6006),J=s(8203);const _=["*"];function K(o,c){if(1&o){const n=t.RV6();t.j41(0,"nz-icon",1),t.bIt("click",function(i){t.eBV(n);const r=t.XpG();return t.Njj(r.closeTag(i))}),t.k0s()}}let k=(()=>{class o{constructor(n,e,i,r){this.cdr=n,this.renderer=e,this.elementRef=i,this.directionality=r,this.isPresetColor=!1,this.nzMode="default",this.nzChecked=!1,this.nzBordered=!0,this.nzOnClose=new t.bkB,this.nzCheckedChange=new t.bkB,this.dir="ltr",this.destroy$=new V.B}updateCheckedStatus(){"checkable"===this.nzMode&&(this.nzChecked=!this.nzChecked,this.nzCheckedChange.emit(this.nzChecked))}closeTag(n){this.nzOnClose.emit(n),n.defaultPrevented||this.renderer.removeChild(this.renderer.parentNode(this.elementRef.nativeElement),this.elementRef.nativeElement)}clearPresetColor(){const n=this.elementRef.nativeElement,e=new RegExp(`(ant-tag-(?:${[...f.un,...f.PA].join("|")}))`,"g"),i=n.classList.toString(),r=[];let a=e.exec(i);for(;null!==a;)r.push(a[1]),a=e.exec(i);n.classList.remove(...r)}setPresetColor(){const n=this.elementRef.nativeElement;this.clearPresetColor(),this.isPresetColor=!!this.nzColor&&((0,f.nP)(this.nzColor)||(0,f.uP)(this.nzColor)),this.isPresetColor&&n.classList.add(`ant-tag-${this.nzColor}`)}ngOnInit(){this.directionality.change?.pipe((0,H.Q)(this.destroy$)).subscribe(n=>{this.dir=n,this.cdr.detectChanges()}),this.dir=this.directionality.value}ngOnChanges(n){const{nzColor:e}=n;e&&this.setPresetColor()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(e){return new(e||o)(t.rXU(t.gRc),t.rXU(t.sFG),t.rXU(t.aKT),t.rXU(J.dS))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["nz-tag"]],hostAttrs:[1,"ant-tag"],hostVars:12,hostBindings:function(e,i){1&e&&t.bIt("click",function(){return i.updateCheckedStatus()}),2&e&&(t.xc7("background-color",i.isPresetColor?"":i.nzColor),t.AVh("ant-tag-has-color",i.nzColor&&!i.isPresetColor)("ant-tag-checkable","checkable"===i.nzMode)("ant-tag-checkable-checked",i.nzChecked)("ant-tag-rtl","rtl"===i.dir)("ant-tag-borderless",!i.nzBordered))},inputs:{nzMode:"nzMode",nzColor:"nzColor",nzChecked:[2,"nzChecked","nzChecked",t.L39],nzBordered:[2,"nzBordered","nzBordered",t.L39]},outputs:{nzOnClose:"nzOnClose",nzCheckedChange:"nzCheckedChange"},exportAs:["nzTag"],features:[t.GFd,t.OA$],ngContentSelectors:_,decls:2,vars:1,consts:[["nzType","close","tabindex","-1",1,"ant-tag-close-icon"],["nzType","close","tabindex","-1",1,"ant-tag-close-icon",3,"click"]],template:function(e,i){1&e&&(t.NAR(),t.SdG(0),t.DNE(1,K,1,0,"nz-icon",0)),2&e&&(t.R7$(),t.vxM("closeable"===i.nzMode?1:-1))},dependencies:[g.Y3,g.Dn],encapsulation:2,changeDetection:0})}}return o})(),W=(()=>{class o{static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275mod=t.$C({type:o})}static{this.\u0275inj=t.G2t({imports:[k]})}}return o})();const Z=()=>[16,16],q=o=>[o];function tt(o,c){1&o&&(t.j41(0,"div",6)(1,"p"),t.EFF(2,"No projects available. Request for a project to pay and download."),t.k0s()())}function et(o,c){if(1&o&&t.nrm(0,"img",14),2&o){const n=t.XpG(2).$implicit;t.Y8G("alt",n.project)("src",null==n?null:n.thumbnail,t.B4B)}}function nt(o,c){1&o&&t.nrm(0,"div",15)}function ot(o,c){if(1&o&&(t.j41(0,"nz-tag",16),t.EFF(1),t.k0s()),2&o){const n=t.XpG(2).$implicit;t.R7$(),t.JRh(n.username)}}function it(o,c){if(1&o&&(t.j41(0,"div",10),t.DNE(1,et,1,2,"img",11)(2,nt,1,0,"ng-template",null,2,t.C5r),t.j41(4,"nz-tag",12),t.EFF(5),t.k0s(),t.DNE(6,ot,2,1,"nz-tag",13),t.k0s()),2&o){const n=t.sdS(3),e=t.XpG().$implicit,i=t.XpG();t.R7$(),t.Y8G("ngIf",null==e?null:e.thumbnail)("ngIfElse",n),t.R7$(4),t.SpI("INR ",e.pay,""),t.R7$(),t.Y8G("ngIf",i.isAdminOrMaster)}}function st(o,c){if(1&o){const n=t.RV6();t.j41(0,"button",18),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2).$implicit,r=t.XpG();return t.Njj(r.handlePayAndDownload(i))}),t.nrm(1,"nz-icon",19),t.EFF(2,"Download "),t.k0s()}}function rt(o,c){if(1&o){const n=t.RV6();t.j41(0,"button",18),t.bIt("click",function(){t.eBV(n);const i=t.XpG(2).$implicit,r=t.XpG();return t.Njj(r.handlePayAndDownload(i))}),t.nrm(1,"nz-icon",20),t.EFF(2,"Pay & Download "),t.k0s()}}function at(o,c){if(1&o&&t.DNE(0,st,3,0,"button",17)(1,rt,3,0,"button",17),2&o){const n=t.XpG().$implicit,e=t.XpG();t.Y8G("ngIf",n.paid||e.isAdminOrMaster),t.R7$(),t.Y8G("ngIf",!n.paid&&!e.isAdminOrMaster)}}function lt(o,c){if(1&o&&(t.j41(0,"div",7)(1,"nz-card",8),t.nrm(2,"nz-card-meta",9),t.k0s(),t.DNE(3,it,7,4,"ng-template",null,0,t.C5r)(5,at,2,2,"ng-template",null,1,t.C5r),t.k0s()),2&o){const n=c.$implicit,e=t.sdS(4),i=t.sdS(6);t.R7$(),t.Y8G("nzCover",e)("nzActions",t.eq3(4,q,i)),t.R7$(),t.Y8G("nzTitle",n.project)("nzDescription",n.desc)}}const ct=[{path:"",component:(()=>{class o{authService;userService;paymentService;dbService;projectService;route;notification;modal;cards=[];clientLogo="";isAdminOrMaster=!1;constructor(n,e,i,r,a,p,P,j){this.authService=n,this.userService=e,this.paymentService=i,this.dbService=r,this.projectService=a,this.route=p,this.notification=P,this.modal=j}ngOnInit(){const n=this.authService.currentUserValue;n&&(this.isAdminOrMaster=n.roles.includes(T.Y.admin)||n.roles.includes(T.Y.master),this.dbService.getClientLogo(n.client).pipe((0,B.n)(e=>(this.clientLogo=e,this.isAdminOrMaster?this.loadAllUserProjects(n.client):this.loadCurrentUserProjects(n.id)))).subscribe(()=>{this.route.queryParams.subscribe(e=>{(e.status||e.projectId||e.userId)&&this.handleQueryParams(e)})},e=>{console.error("Error fetching client logo:",e)}))}handleQueryParams(n){const e=n.status,i=n.projectId;if("success"===e&&i&&n.userId){this.notification.success("Success","Payment successful. You can now download the file.");const a=this.cards.find(p=>p.projectId===i);a&&this.downloadFile(a.file)}else"failure"===e&&this.notification.error("Error","Payment failed. Please try again.")}loadAllUserProjects(n){return this.userService.getUsers(n).pipe((0,u.T)(e=>{e&&(this.cards=e.flatMap(i=>i.projects.map(r=>({...r,thumbnail:r.thumbnail||this.clientLogo,username:i.username}))))}),(0,U.W)(e=>(console.error("Error fetching user projects:",e),(0,D.of)())))}loadCurrentUserProjects(n){return this.userService.getUser(n).pipe((0,u.T)(e=>{e&&(this.cards=e.projects.map(i=>({...i,thumbnail:i.thumbnail||this.clientLogo,username:e.username})))}),(0,U.W)(e=>(console.error("Error fetching user projects:",e),(0,D.of)())))}downloadFile(n){const e=document.createElement("a");e.href=n;const i=n.split("/").pop()||"download";e.download=i,e.target="_blank",e.click()}handlePayAndDownload(n){const e=this.authService.currentUserValue;e?n.paid||this.isAdminOrMaster?(this.downloadFile(n.file),this.notification.success("Success","Downloaded successfully")):this.userService.getUser(e.id).subscribe(i=>{i?i.email&&i.phone?this.initiatePayment(n,i):this.showUserDetailsModal(i,n):this.notification.error("Error","User details not found.")}):this.notification.error("Error","User not authenticated. Please log in.")}showUserDetailsModal(n,e){const i=this.modal.create({nzTitle:"Personal Details",nzContent:G,nzData:{user:n},nzOkText:"Pay now",nzOnOk:()=>{const a=i.getContentComponent().getUserDetails();this.userService.updateUser(a).subscribe(()=>{this.initiatePayment(e,a)})}})}initiatePayment(n,e){this.paymentService.initiatePayUPayment(n,e).subscribe({next:()=>{console.log("Payment initiation complete")},error:i=>{console.error("Error initiating payment:",i),this.notification.error("Error","Error initiating payment. Please try again.")}})}static \u0275fac=function(e){return new(e||o)(t.rXU(A.u),t.rXU(R.D),t.rXU(N),t.rXU(O.a),t.rXU(w.T),t.rXU(z.nX),t.rXU(Q.xY),t.rXU(v.N_))};static \u0275cmp=t.VBU({type:o,selectors:[["app-clients"]],standalone:!1,decls:3,vars:4,consts:[["coverTemplate",""],["payDownload",""],["placeholder",""],["nz-row","",1,"clients-container",3,"nzGutter"],["class","no-projects-message",4,"ngIf"],["nz-col","","nzXs","24","nzSm","12","nzMd","8","nzLg","6","nzXl","6",4,"ngFor","ngForOf"],[1,"no-projects-message"],["nz-col","","nzXs","24","nzSm","12","nzMd","8","nzLg","6","nzXl","6"],[1,"card-shadow",3,"nzCover","nzActions"],[3,"nzTitle","nzDescription"],[1,"card-cover"],["class","card-image",3,"alt","src",4,"ngIf","ngIfElse"],["nzColor","success",1,"card-tag"],["nzColor","processing","class","card-username",4,"ngIf"],[1,"card-image",3,"alt","src"],[1,"card-placeholder"],["nzColor","processing",1,"card-username"],["nz-button","","nzType","default","nzShape","round",3,"click",4,"ngIf"],["nz-button","","nzType","default","nzShape","round",3,"click"],["nzType","download"],["nzType","credit-card"]],template:function(e,i){1&e&&(t.j41(0,"div",3),t.DNE(1,tt,3,0,"div",4)(2,lt,7,6,"div",5),t.k0s()),2&e&&(t.Y8G("nzGutter",t.lJ4(3,Z)),t.R7$(),t.Y8G("ngIf",0===i.cards.length),t.R7$(),t.Y8G("ngForOf",i.cards))},dependencies:[h.Sq,h.bT,y.cK,y.ls,g.Dn,S.aO,$.c,L.p,k,m.Uq,m.e],styles:[".no-projects-message[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%;width:100%;text-align:center;padding:20px;font-size:16px;color:#888}.card-shadow[_ngcontent-%COMP%]{box-shadow:0 4px 8px #0000001a,0 6px 10px #0000001a;margin-bottom:16px}.clients-container[_ngcontent-%COMP%]{padding:16px}.card-cover[_ngcontent-%COMP%]{position:relative}.card-image[_ngcontent-%COMP%]{width:100%;height:auto;max-height:200px;object-fit:cover}.card-placeholder[_ngcontent-%COMP%]{width:100%;height:200px;background-color:#f0f0f0}.card-tag[_ngcontent-%COMP%]{position:absolute;top:5px;right:5px}.card-username[_ngcontent-%COMP%]{position:absolute;bottom:5px;right:5px}"]})}return o})()}];let dt=(()=>{class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=t.$C({type:o});static \u0275inj=t.G2t({imports:[z.iI.forChild(ct),z.iI]})}return o})();var mt=s(9692),pt=s(1672),ht=s(8927);let ut=(()=>{class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=t.$C({type:o});static \u0275inj=t.G2t({imports:[h.MD,dt,y.Ti,g.Y3,S.Zw,W,m.f3,mt.y,pt._v,v.U6,l.X1,ht.PQ,M.q1]})}return o})()}}]);