"use strict";(self.webpackChunkarchitect=self.webpackChunkarchitect||[]).push([[409],{1409:(st,v,i)=>{i.r(v),i.d(v,{ClientsModule:()=>ot});var m=i(177),g=i(6530),y=i(4181),t=i(4438),_=i(4796),P=i(7772),$=i(9885),E=i(6368),k=i(6648),j=i(6354);let I=(()=>{class o{testMode=!0;key="your_payu_key";salt="your_payu_salt";initiatePayUPayment(e){const n=this.testMode?"https://test.payu.in/_payment":"https://secure.payu.in/_payment",s=(0,E.A)(),r=`${window.location.origin}/clients?status=success&projectId=${e.projectId}&userId=${e.username}`,a=`${window.location.origin}/clients?status=failure`;return this.generateHash(`${this.key}|${s}|${e.pay}|${e.project}|${e.username}|||||||||||${this.salt}`).pipe((0,j.T)(z=>{const d=document.createElement("form");d.method="POST",d.action=n;const T={key:this.key,txnid:s,amount:e.pay,productinfo:e.project,firstname:e.username,email:"user@example.com",phone:"1234567890",surl:r,furl:a,hash:z,service_provider:"payu_paisa"};Object.keys(T).forEach(S=>{const u=document.createElement("input");u.type="hidden",u.name=S,u.value=T[S],d.appendChild(u)}),document.body.appendChild(d),d.submit()}))}generateHash(e){const n=(new TextEncoder).encode(e);return(0,k.H)(crypto.subtle.digest("SHA-512",n)).pipe((0,j.T)(s=>this.bufferToHex(s)))}bufferToHex(e){return Array.prototype.map.call(new Uint8Array(e),n=>("00"+n.toString(16)).slice(-2)).join("")}static \u0275fac=function(n){return new(n||o)};static \u0275prov=t.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var M=i(1279),G=i(9803),f=i(2914),p=i(5664),x=i(513),U=i(6389),D=i(5930),X=i(1413),R=i(6977),h=i(6006),A=i(8203);const F=["*"];function O(o,c){if(1&o){const e=t.RV6();t.j41(0,"nz-icon",1),t.bIt("click",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.closeTag(s))}),t.k0s()}}let b=(()=>{class o{constructor(e,n,s,r){this.cdr=e,this.renderer=n,this.elementRef=s,this.directionality=r,this.isPresetColor=!1,this.nzMode="default",this.nzChecked=!1,this.nzBordered=!0,this.nzOnClose=new t.bkB,this.nzCheckedChange=new t.bkB,this.dir="ltr",this.destroy$=new X.B}updateCheckedStatus(){"checkable"===this.nzMode&&(this.nzChecked=!this.nzChecked,this.nzCheckedChange.emit(this.nzChecked))}closeTag(e){this.nzOnClose.emit(e),e.defaultPrevented||this.renderer.removeChild(this.renderer.parentNode(this.elementRef.nativeElement),this.elementRef.nativeElement)}clearPresetColor(){const e=this.elementRef.nativeElement,n=new RegExp(`(ant-tag-(?:${[...h.un,...h.PA].join("|")}))`,"g"),s=e.classList.toString(),r=[];let a=n.exec(s);for(;null!==a;)r.push(a[1]),a=n.exec(s);e.classList.remove(...r)}setPresetColor(){const e=this.elementRef.nativeElement;this.clearPresetColor(),this.isPresetColor=!!this.nzColor&&((0,h.nP)(this.nzColor)||(0,h.uP)(this.nzColor)),this.isPresetColor&&e.classList.add(`ant-tag-${this.nzColor}`)}ngOnInit(){this.directionality.change?.pipe((0,R.Q)(this.destroy$)).subscribe(e=>{this.dir=e,this.cdr.detectChanges()}),this.dir=this.directionality.value}ngOnChanges(e){const{nzColor:n}=e;n&&this.setPresetColor()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(t.gRc),t.rXU(t.sFG),t.rXU(t.aKT),t.rXU(A.dS))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["nz-tag"]],hostAttrs:[1,"ant-tag"],hostVars:12,hostBindings:function(n,s){1&n&&t.bIt("click",function(){return s.updateCheckedStatus()}),2&n&&(t.xc7("background-color",s.isPresetColor?"":s.nzColor),t.AVh("ant-tag-has-color",s.nzColor&&!s.isPresetColor)("ant-tag-checkable","checkable"===s.nzMode)("ant-tag-checkable-checked",s.nzChecked)("ant-tag-rtl","rtl"===s.dir)("ant-tag-borderless",!s.nzBordered))},inputs:{nzMode:"nzMode",nzColor:"nzColor",nzChecked:[2,"nzChecked","nzChecked",t.L39],nzBordered:[2,"nzBordered","nzBordered",t.L39]},outputs:{nzOnClose:"nzOnClose",nzCheckedChange:"nzCheckedChange"},exportAs:["nzTag"],features:[t.GFd,t.OA$],ngContentSelectors:F,decls:2,vars:1,consts:[["nzType","close","tabindex","-1",1,"ant-tag-close-icon"],["nzType","close","tabindex","-1",1,"ant-tag-close-icon",3,"click"]],template:function(n,s){1&n&&(t.NAR(),t.SdG(0),t.DNE(1,O,1,0,"nz-icon",0)),2&n&&(t.R7$(),t.vxM("closeable"===s.nzMode?1:-1))},dependencies:[p.Y3,p.Dn],encapsulation:2,changeDetection:0})}}return o})(),w=(()=>{class o{static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275mod=t.$C({type:o})}static{this.\u0275inj=t.G2t({imports:[b]})}}return o})();var C=i(7529);const N=()=>[48,24],B=o=>[o];function Y(o,c){1&o&&(t.j41(0,"div",6)(1,"p"),t.EFF(2,"No projects available. Request for a project to pay and download."),t.k0s()())}function L(o,c){if(1&o&&t.nrm(0,"img",14),2&o){const e=t.XpG(2).$implicit;t.Y8G("alt",e.project)("src",null==e?null:e.thumbnail,t.B4B)}}function V(o,c){1&o&&t.nrm(0,"div",15)}function H(o,c){if(1&o&&(t.j41(0,"nz-tag",16),t.EFF(1),t.k0s()),2&o){const e=t.XpG(2).$implicit;t.R7$(),t.JRh(e.username)}}function J(o,c){if(1&o&&(t.j41(0,"div",10),t.DNE(1,L,1,2,"img",11)(2,V,1,0,"ng-template",null,2,t.C5r),t.j41(4,"nz-tag",12),t.EFF(5),t.k0s(),t.DNE(6,H,2,1,"nz-tag",13),t.k0s()),2&o){const e=t.sdS(3),n=t.XpG().$implicit,s=t.XpG();t.R7$(),t.Y8G("ngIf",null==n?null:n.thumbnail)("ngIfElse",e),t.R7$(4),t.SpI("INR ",n.pay,""),t.R7$(),t.Y8G("ngIf",s.isAdminOrMaster)}}function K(o,c){if(1&o){const e=t.RV6();t.j41(0,"button",18),t.bIt("click",function(){t.eBV(e);const s=t.XpG(2).$implicit,r=t.XpG();return t.Njj(r.handlePayAndDownload(s))}),t.nrm(1,"nz-icon",19),t.EFF(2,"Download "),t.k0s()}}function Q(o,c){if(1&o){const e=t.RV6();t.j41(0,"button",18),t.bIt("click",function(){t.eBV(e);const s=t.XpG(2).$implicit,r=t.XpG();return t.Njj(r.handlePayAndDownload(s))}),t.nrm(1,"nz-icon",20),t.EFF(2,"Pay & Download "),t.k0s()}}function Z(o,c){if(1&o&&t.DNE(0,K,3,0,"button",17)(1,Q,3,0,"button",17),2&o){const e=t.XpG().$implicit,n=t.XpG();t.Y8G("ngIf",e.paid||n.isAdminOrMaster),t.R7$(),t.Y8G("ngIf",!e.paid&&!n.isAdminOrMaster)}}function W(o,c){if(1&o&&(t.j41(0,"div",7)(1,"nz-card",8),t.nrm(2,"nz-card-meta",9),t.k0s(),t.DNE(3,J,7,4,"ng-template",null,0,t.C5r)(5,Z,2,2,"ng-template",null,1,t.C5r),t.k0s()),2&o){const e=c.$implicit,n=t.sdS(4),s=t.sdS(6);t.R7$(),t.Y8G("nzCover",n)("nzActions",t.eq3(4,B,s)),t.R7$(),t.Y8G("nzTitle",e.project)("nzDescription",e.desc)}}const q=[{path:"",component:(()=>{class o{authService;dbService;userService;paymentService;route;projectService;notification;cards=[];clientLogo="";isAdminOrMaster=!1;constructor(e,n,s,r,a,l,z){this.authService=e,this.dbService=n,this.userService=s,this.paymentService=r,this.route=a,this.projectService=l,this.notification=z}ngOnInit(){const e=this.authService.currentUserValue;e&&(this.isAdminOrMaster=e.roles.includes(y.Y.admin)||e.roles.includes(y.Y.master),this.dbService.getClientLogo(e.client).subscribe(n=>{this.clientLogo=n,this.isAdminOrMaster?this.loadAllUserProjects(e.client):this.loadCurrentUserProjects(e.id)},n=>{console.error("Error fetching client logo:",n)})),this.route.queryParams.subscribe(n=>{const s=n.status,r=n.projectId,a=n.userId;"success"===s&&r&&a?this.projectService.updateProjectPaymentStatus(a,r,!0).subscribe(()=>{this.notification.success("Success","Payment successful. You can now download the file."),this.downloadFile(this.cards.find(l=>l.projectId===r)?.file||"")},l=>{console.error("Error updating payment status:",l)}):"failure"===s&&this.notification.error("Error","Payment failed. Please try again.")})}loadAllUserProjects(e){this.userService.getUsers(e).subscribe(n=>{n&&(this.cards=n.flatMap(s=>s.projects.map(r=>({...r,thumbnail:this.clientLogo,username:s.username}))))},n=>{console.error("Error fetching user projects:",n)})}loadCurrentUserProjects(e){this.userService.getUser(e).subscribe(n=>{n&&(this.cards=n.projects.map(s=>({...s,thumbnail:this.clientLogo,username:n.username})))},n=>{console.error("Error fetching user projects:",n)})}downloadFile(e){const n=document.createElement("a");n.href=e,n.download=e.split("/").pop()||"download",n.click()}handlePayAndDownload(e){e.paid||this.isAdminOrMaster?(this.downloadFile(e.file),this.notification.success("Success","Downloaded successfully")):this.paymentService.initiatePayUPayment(e).subscribe({error:n=>{console.error("Error initiating payment:",n),this.notification.error("Error","Error initiating payment. Please try again.")},complete:()=>{console.log("Payment initiation complete")}})}static \u0275fac=function(n){return new(n||o)(t.rXU(_.u),t.rXU(P.a),t.rXU($.D),t.rXU(I),t.rXU(g.nX),t.rXU(M.T),t.rXU(G.xY))};static \u0275cmp=t.VBU({type:o,selectors:[["app-clients"]],standalone:!1,decls:3,vars:4,consts:[["coverTemplate",""],["payDownload",""],["placeholder",""],["nz-row","",3,"nzGutter"],["class","no-projects-message",4,"ngIf"],["nz-col","24","nzXs","24","nzSm","24","nzMd","12","nzLg","6","nzXl","6",4,"ngFor","ngForOf"],[1,"no-projects-message"],["nz-col","24","nzXs","24","nzSm","24","nzMd","12","nzLg","6","nzXl","6"],[1,"card-shadow",2,"width","280px","height","320px",3,"nzCover","nzActions"],[3,"nzTitle","nzDescription"],[2,"position","relative"],["width","280px","style","min-height:150px; max-height: 200px;",3,"alt","src",4,"ngIf","ngIfElse"],["nzColor","success",2,"position","absolute","top","5px","right","0px"],["nzColor","processing","style","position: absolute; bottom: 5px; right: 0px;",4,"ngIf"],["width","280px",2,"min-height","150px","max-height","200px",3,"alt","src"],[2,"width","280px","height","170px","background-color","#f0f0f0"],["nzColor","processing",2,"position","absolute","bottom","5px","right","0px"],["nz-button","","nzType","default","nzShape","round",3,"click",4,"ngIf"],["nz-button","","nzType","default","nzShape","round",3,"click"],["nzType","download"],["nzType","credit-card"]],template:function(n,s){1&n&&(t.j41(0,"div",3),t.DNE(1,Y,3,0,"div",4)(2,W,7,6,"div",5),t.k0s()),2&n&&(t.Y8G("nzGutter",t.lJ4(3,N)),t.R7$(),t.Y8G("ngIf",0===s.cards.length),t.R7$(),t.Y8G("ngForOf",s.cards))},dependencies:[m.Sq,m.bT,f.cK,f.ls,p.Dn,x.aO,U.c,D.p,b,C.Uq,C.e],styles:[".no-projects-message[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%;width:100%;text-align:center;padding:20px}.card-shadow[_ngcontent-%COMP%]{box-shadow:0 4px 8px #0000001a,0 6px 10px #0000001a}.no-projects-message[_ngcontent-%COMP%]{text-align:center;font-size:18px;color:#888;margin-top:50px}"]})}return o})()}];let tt=(()=>{class o{static \u0275fac=function(n){return new(n||o)};static \u0275mod=t.$C({type:o});static \u0275inj=t.G2t({imports:[g.iI.forChild(q),g.iI]})}return o})();var et=i(9692),nt=i(1672);let ot=(()=>{class o{static \u0275fac=function(n){return new(n||o)};static \u0275mod=t.$C({type:o});static \u0275inj=t.G2t({imports:[m.MD,tt,f.Ti,p.Y3,x.Zw,w,C.f3,et.y,nt._v]})}return o})()}}]);